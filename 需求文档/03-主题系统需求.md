# 主题系统需求

## 主题系统概述

主题系统是薯片生态前端视觉层的核心机制。组件库只提供功能和布局，所有视觉样式都由主题包提供。主题系统支持原子级应用、层级覆盖、动态切换，让用户可以完全自定义界面外观。

## 核心概念

### 主题包（Theme Package）

主题包是一个独立的、完整的视觉设计实现，包含：

- **组件样式**：所有组件的CSS样式定义
- **设计tokens**：颜色、字体、间距、圆角、阴影等设计变量
- **自定义元素**：装饰性元素、图标、图片、动画
- **布局增强**：额外的布局调整和视觉优化
- **主题元数据**：主题名称、作者、版本、预览图等信息

主题包是独立的产品，可以单独开发、发布、安装、商业化。

### 样式接口点（Style Interface Points）

样式接口点是组件暴露给主题包的注入点，定义了主题可以控制的视觉部分：

- **容器接口点**：组件的外层容器元素
- **内容接口点**：组件的内容区域元素
- **状态接口点**：组件的不同状态（hover、active、disabled、focus等）
- **子元素接口点**：组件的特定子元素（按钮文本、输入框边框、图标等）
- **动画接口点**：组件的动画和过渡效果

### 原子级主题应用

主题可以应用到任意粒度的界面单元：

- **全局级**：整个应用使用统一主题
- **页面级**：不同页面使用不同主题
- **组件级**：单个组件使用独立主题
- **卡片级**：每个基础卡片使用独立主题
- **元素级**：组件内的特定元素使用独立主题

### 层级覆盖机制

主题配置采用层级覆盖，从低到高依次是：

1. **系统默认主题**：生态内置的默认主题
2. **全局主题**：用户在系统设置中配置的主题
3. **应用主题**：软件自带或用户为软件设置的主题
4. **卡片主题**：在卡片metadata.yaml中设置的主题
5. **组件主题**：在组件Props中直接指定的主题

高层级的主题设置会覆盖低层级的设置。未设置时使用上一层级的主题。

## 主题包功能需求

### 主题包结构

#### 主题包元数据

**必需字段**
- `id`: 主题包唯一标识（如"chips-official-macaron"）
- `name`: 主题包名称（如"马卡龙配色"）
- `version`: 主题包版本（如"1.0.0"）
- `author`: 主题包作者信息
- `description`: 主题包描述

**可选字段**
- `preview`: 主题预览图URL
- `homepage`: 主题包主页
- `license`: 许可证信息
- `keywords`: 关键词标签
- `dependencies`: 依赖的其他主题包

#### 设计Tokens

主题包需要定义设计token，作为设计变量供样式使用：

**颜色系统**
- 主色（primary）：品牌色，用于主要按钮、链接等
- 辅助色（secondary）：辅助品牌色
- 成功色（success）：成功状态
- 警告色（warning）：警告状态
- 错误色（error）：错误状态
- 信息色（info）：信息提示
- 文本色（text）：各级文本颜色（主要、次要、说明、禁用）
- 背景色（background）：各级背景颜色
- 边框色（border）：边框颜色

**字体系统**
- 字体族（fontFamily）：主字体、代码字体
- 字体大小（fontSize）：xs、sm、base、lg、xl、2xl等
- 字重（fontWeight）：light、normal、medium、bold
- 行高（lineHeight）：紧凑、常规、宽松

**间距系统**
- 间距单位（spacing）：0、1、2、4、8、12、16、24、32、48、64等

**圆角系统**
- 圆角值（borderRadius）：none、sm、base、lg、full

**阴影系统**
- 阴影（shadow）：sm、base、lg、xl、inner

**动画系统**
- 过渡时长（duration）：fast、base、slow
- 缓动函数（easing）：ease、ease-in、ease-out、ease-in-out

#### 组件样式

主题包需要为每个组件类型提供完整的样式实现：

**基础组件样式**
- Button样式：不同类型、不同尺寸、不同状态的样式
- Input样式：输入框、前缀后缀、聚焦状态、错误状态
- Select样式：选择器、下拉菜单、选项样式
- Checkbox、Radio、Switch样式
- 所有其他基础组件的样式

**布局组件样式**
- 容器的边距、内边距
- 卡片的阴影、边框、圆角
- 布局的间距和对齐

**卡片组件样式**
- Markdown卡片：标题、段落、列表、代码块、引用等样式
- 图片卡片：图片容器、说明文字、预览样式
- 视频卡片：播放器样式、控制条样式
- 所有其他卡片类型的样式

**全局样式**
- 滚动条样式
- 选中文本样式
- 焦点轮廓样式
- 页面背景和布局

#### 自定义增强

主题包可以添加额外的视觉增强：

- **装饰元素**：背景图案、装饰图形、边角装饰
- **图标集**：自定义图标库
- **动画效果**：进入/退出动画、过渡动画、交互动画
- **特殊效果**：毛玻璃效果、渐变效果、纹理效果
- **响应式调整**：不同屏幕尺寸的样式调整

### 主题包安装与管理

#### 主题包发现

- 用户可以浏览主题包市场
- 支持按分类、标签、评分、下载量筛选
- 支持搜索主题包
- 显示主题包预览图和详细信息

#### 主题包安装

- 支持一键安装主题包
- 支持从本地导入主题包
- 安装时验证主题包完整性
- 显示安装进度和结果

#### 主题包管理

- 查看已安装的主题包列表
- 查看主题包详细信息
- 更新主题包到最新版本
- 卸载不需要的主题包
- 备份和恢复主题包

### 主题应用与配置

#### 全局主题设置

- 在系统设置中选择全局主题
- 预览主题效果
- 实时切换主题
- 保存主题配置

#### 应用主题设置

- 为特定软件设置专属主题
- 覆盖全局主题设置
- 支持软件自带主题

#### 卡片主题设置

- 在卡片编辑器中为卡片设置主题
- 在metadata.yaml中记录主题标识
- 支持卡片独立于应用的主题
- 复合卡片中的基础卡片可以有不同主题

#### 组件主题设置

- 在组件Props中直接指定主题
- 用于特殊场景的主题定制
- 优先级最高，覆盖所有其他设置

### 主题预览与测试

#### 主题预览

- 安装前可以预览主题效果
- 显示主题在不同组件上的效果
- 显示主题在不同卡片类型上的效果
- 支持实时预览模式

#### 主题测试

- 提供主题测试页面
- 展示所有组件在该主题下的样式
- 展示所有状态（hover、active、disabled等）
- 展示所有尺寸和变体
- 方便开发者测试主题完整性

### 主题自定义

#### 在线主题编辑器

- 提供可视化主题编辑器
- 可以调整设计tokens
- 可以预览实时效果
- 可以导出自定义主题

#### 主题继承

- 支持基于现有主题创建新主题
- 只修改部分变量，继承其他样式
- 减少重复工作

#### 局部主题覆盖

- 允许用户覆盖主题包的部分样式
- 在不修改原主题包的情况下定制
- 保存为个人配置

## 样式注入机制需求

### CSS变量注入

主题包通过CSS变量注入设计tokens：

```css
:root {
  --chips-color-primary: #1890ff;
  --chips-color-success: #52c41a;
  --chips-font-size-base: 14px;
  --chips-spacing-base: 8px;
  --chips-border-radius: 4px;
  /* ...更多变量 */
}
```

组件样式使用这些CSS变量：

```css
.chips-button-primary {
  background-color: var(--chips-color-primary);
  font-size: var(--chips-font-size-base);
  padding: var(--chips-spacing-base) calc(var(--chips-spacing-base) * 2);
  border-radius: var(--chips-border-radius);
}
```

### 类名约定

组件使用约定的类名，主题包针对这些类名提供样式：

**命名规范**
- 组件基础类：`chips-[component-name]`（如`chips-button`）
- 组件变体类：`chips-[component-name]-[variant]`（如`chips-button-primary`）
- 组件状态类：`chips-[component-name]-[state]`（如`chips-button-disabled`）
- 组件尺寸类：`chips-[component-name]-[size]`（如`chips-button-lg`）
- 组件元素类：`chips-[component-name]-[element]`（如`chips-button-icon`）

**类名组合**
- 一个元素可以有多个类名
- 类名组合提供精确的样式控制
- 例如：`chips-button chips-button-primary chips-button-lg chips-button-loading`

### 样式作用域

主题包的样式应该有明确的作用域：

**全局作用域**
- 设计tokens（CSS变量）
- 全局重置样式
- 通用工具类

**组件作用域**
- 组件的样式只作用于该组件
- 使用类名前缀避免冲突
- 不影响其他组件

**主题作用域**
- 不同主题的样式互不干扰
- 支持主题嵌套使用
- 通过主题容器隔离

### 样式优先级

样式的优先级从低到高：

1. 浏览器默认样式
2. 全局重置样式
3. 设计tokens（CSS变量默认值）
4. 组件基础样式
5. 主题包全局样式
6. 主题包组件样式
7. 用户自定义样式
8. 内联样式（Props中的style）

### 动态样式更新

- 主题切换时样式立即更新
- 支持CSS变量的动态修改
- 支持平滑的主题切换动画
- 不需要重新渲染组件树

## 主题包开发需求

### 开发工具

#### 主题包脚手架

- 提供主题包项目模板
- 包含基本的目录结构和配置文件
- 包含所有必需的样式文件模板
- 快速创建新主题包项目

#### 主题开发服务器

- 提供本地开发服务器
- 实时预览主题效果
- 热重载样式更新
- 展示所有组件和状态

#### 主题构建工具

- 编译和打包主题包
- 压缩CSS文件
- 生成主题包元数据
- 验证主题包完整性

### 开发规范

#### 必需组件覆盖

主题包必须为以下核心组件提供样式：

- 所有P0基础组件
- 所有P0布局组件
- 所有P0卡片组件
- 表单组件

#### 样式完整性

- 覆盖组件的所有状态
- 覆盖组件的所有变体
- 覆盖组件的所有尺寸
- 提供清晰的视觉反馈

#### 一致性要求

- 设计风格统一
- 颜色使用一致
- 间距和对齐统一
- 动画效果协调

#### 可访问性要求

- 保证文本对比度符合WCAG标准
- 提供清晰的焦点指示
- 支持高对比度模式
- 不依赖颜色传达唯一信息

### 测试与发布

#### 主题测试

- 在所有组件上测试
- 在不同浏览器中测试
- 在不同屏幕尺寸上测试
- 测试主题嵌套情况

#### 主题发布

- 填写主题包信息
- 上传预览图和截图
- 设置许可证和定价
- 发布到主题包市场

#### 版本管理

- 遵循语义化版本
- 记录版本更新日志
- 保持向后兼容
- 提供升级指南

## 内置主题需求

### 默认主题（Default Theme）

**定位**：简洁、清晰、通用的默认主题

**特点**
- 采用中性的颜色方案
- 清晰的层级关系
- 良好的可读性
- 适合大多数使用场景

### 暗色主题（Dark Theme）

**定位**：深色背景，适合夜间使用

**特点**
- 深色背景减少眼睛疲劳
- 高对比度保证可读性
- 适合低光环境
- 节省OLED屏幕电量

### 高对比度主题（High Contrast Theme）

**定位**：高对比度，便于视力障碍用户

**特点**
- 极高的颜色对比度
- 粗边框和清晰轮廓
- 符合无障碍标准
- 简化视觉元素

## 主题包市场需求

### 市场功能

- 浏览主题包列表
- 搜索和筛选主题包
- 查看主题包详情
- 预览主题包效果
- 安装和购买主题包
- 评价和评论主题包

### 开发者功能

- 注册开发者账号
- 上传主题包
- 管理主题包版本
- 查看下载和收入统计
- 回复用户评论

### 商业化支持

- 支持免费主题包
- 支持付费主题包
- 支持订阅制主题包
- 支持主题包打赏
- 开发者收益分成

## 技术要求

### 性能要求

- 主题包加载时间 < 200ms
- 主题切换动画流畅（60fps）
- CSS文件大小 < 200KB（压缩后）
- 不影响组件渲染性能

### 兼容性要求

- 支持CSS变量（现代浏览器）
- 支持CSS Grid和Flexbox
- 支持CSS动画和过渡
- 降级方案（不支持CSS变量时使用默认样式）

### 扩展性要求

- 支持主题插件机制
- 支持第三方样式预处理器
- 支持CSS-in-JS方案
- 支持原子化CSS框架

## 用户故事

### 故事1：用户切换全局主题

**作为** 薯片应用用户  
**我想要** 切换应用的整体主题  
**以便** 获得我喜欢的视觉风格

**验收标准**
- 在设置页面可以看到所有已安装的主题
- 点击主题可以预览效果
- 选择主题后整个应用立即更新
- 主题设置被保存，下次启动时仍然生效

### 故事2：用户为卡片设置独立主题

**作为** 卡片创作者  
**我想要** 为某个卡片设置特殊的主题  
**以便** 让这个卡片看起来与众不同

**验收标准**
- 在卡片编辑器中可以选择主题
- 预览时可以看到主题效果
- 该卡片的主题不影响其他卡片
- 主题设置保存在卡片的metadata中

### 故事3：设计师开发主题包

**作为** 主题设计师  
**我想要** 开发并发布自己的主题包  
**以便** 让更多人使用我的设计并获得收益

**验收标准**
- 有详细的主题开发文档
- 有主题包脚手架工具
- 有本地预览和测试环境
- 可以发布主题包到市场
- 可以看到下载量和收益

### 故事4：用户安装主题包

**作为** 薯片应用用户  
**我想要** 安装新的主题包  
**以便** 尝试不同的视觉风格

**验收标准**
- 可以浏览主题包市场
- 可以搜索和筛选主题包
- 可以预览主题效果
- 可以一键安装主题包
- 安装后立即可以使用

### 故事5：用户自定义主题

**作为** 有一定技术能力的用户  
**我想要** 定制主题的某些部分  
**以便** 创建完全符合我喜好的主题

**验收标准**
- 有可视化的主题编辑器
- 可以调整颜色、字体、间距等
- 可以实时预览调整效果
- 可以保存和导出自定义主题

## 非功能需求

### 易用性

- 主题切换操作简单直观
- 主题效果预览清晰准确
- 主题管理界面友好
- 错误提示明确

### 稳定性

- 主题包异常不影响应用运行
- 主题切换不导致闪烁或错乱
- 降级方案保证基本可用
- 主题包版本更新平滑

### 安全性

- 主题包代码沙箱隔离
- 不允许执行任意JavaScript
- 限制CSS的危险特性
- 验证主题包来源和签名

## 总结

主题系统是薯片生态视觉层的核心，通过功能与样式的完全分离、原子级主题应用、层级覆盖机制，实现了极大的视觉自由度。主题包作为独立产品，形成了开放的主题生态。用户可以自由选择和切换主题，设计师可以开发和商业化主题包，开发者可以灵活定制界面。这种设计让薯片应用能够适应不同用户的审美需求，同时为主题设计师提供了创作和变现的平台。
