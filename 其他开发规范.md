# 薯片组件库 - Vue 3 开发规范（详细版）

**版本**: 1.1.0  
**最后更新**: 2026-02-01  
**适用范围**: @chips/components（Vue 3 无样式组件库）

---

> 本文档是 [开发规范](开发规范.md) 的 Vue 3 详细补充版本，提供更详细的 Vue 3 特性使用指南。

## 一、核心理念

### 1.1 组件库定位

```
┌─────────────────────────────────────────────────────────────┐
│                    薯片组件库定位                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  技术栈：Vue 3 + TypeScript                                 │
│  特点：                                                      │
│    • 无样式组件（Unstyled Components）                      │
│    • 只实现功能和布局逻辑                                    │
│    • 样式完全由主题包提供                                    │
│    • 布局逻辑固定，不可通过主题修改                          │
│                                                             │
│  组件不包含：                                                │
│    ❌ <style> 标签                                          │
│    ❌ 内联 style 属性                                       │
│    ❌ 硬编码的样式值                                         │
│    ❌ 具体的基础卡片组件（在插件中实现）                     │
│                                                             │
│  组件包含：                                                  │
│    ✅ <template> - HTML 结构和 CSS 类名                     │
│    ✅ <script> - 功能逻辑和交互                             │
│    ✅ TypeScript 类型定义                                   │
│    ✅ 通用 UI 组件和卡片辅助组件                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 重要说明

**组件库不包含具体的基础卡片组件**（如 MarkdownCard、VideoCard、ImageCard 等）。根据薯片生态的架构设计，基础卡片组件应该在各自的插件中实现。详见：
- [插件开发规范](../生态共用/07-插件开发规范.md)
- [基础卡片插件的结构](../生态设计原稿（一切标准）/03-基础卡片插件的结构.md)

### 1.2 与主题包的关系

```
组件库（@chips/components）
    ↓ 暴露 CSS 类名接口点
主题包（@chips/theme-*）
    ↓ 实现样式
最终界面
```

---

## 二、组件开发规范

### 2.1 组件文件结构

```vue
<!-- @chips/components/Button.vue -->

<script setup lang="ts">
// ===== 1. 类型定义 =====
interface ButtonProps {
  type?: "default" | "primary" | "dashed" | "danger";
  size?: "small" | "medium" | "large";
  disabled?: boolean;
  loading?: boolean;
}

// ===== 2. Props 定义 =====
const props = withDefaults(defineProps<ButtonProps>(), {
  type: "default",
  size: "medium",
  disabled: false,
  loading: false
});

// ===== 3. Emits 定义 =====
const emit = defineEmits<{
  click: [event: MouseEvent];
}>();

// ===== 4. 组合式函数（可选）=====
// 复杂逻辑可以抽取到 composables

// ===== 5. 事件处理 =====
const handleClick = (e: MouseEvent) => {
  if (props.disabled || props.loading) {
    e.preventDefault();
    return;
  }
  emit("click", e);
};
</script>

<template>
  <!-- ===== 6. 模板：只定义结构和类名 ===== -->
  <button
    :class="[
      'chips-button',
      `chips-button--${type}`,
      `chips-button--${size}`,
      { 'chips-button--disabled': disabled },
      { 'chips-button--loading': loading }
    ]"
    :disabled="disabled || loading"
    @click="handleClick"
  >
    <span v-if="loading" class="chips-button__spinner" />
    <span class="chips-button__content">
      <slot />
    </span>
  </button>
</template>

<!-- ❌ 不包含 <style> 标签 -->
```

### 2.2 强制要求

| 规则 | 说明 |
|------|------|
| ❌ 禁止 `<style>` | 组件不得包含任何样式定义 |
| ❌ 禁止内联样式 | 不得使用 `:style` 绑定（除非动态计算布局） |
| ✅ 必须使用类名 | 通过 CSS 类名暴露样式接口点 |
| ✅ 必须 TypeScript | 所有 Props 和 Emits 必须有类型 |
| ✅ 必须文档注释 | 公共 Props 必须有 JSDoc 注释 |

### 2.3 Props 命名规范

```typescript
// ✅ 正确的 Props 命名
interface SelectProps {
  // 布尔值：直接用形容词或 is/has 前缀
  disabled?: boolean;
  multiple?: boolean;
  clearable?: boolean;
  filterable?: boolean;
  isOpen?: boolean;
  hasValue?: boolean;
  
  // 值类型
  modelValue?: string | string[];  // Vue 3 v-model
  placeholder?: string;
  options?: SelectOption[];
  
  // 尺寸和变体
  size?: "small" | "medium" | "large";
  variant?: "outlined" | "filled";
}

// Emits 定义
const emit = defineEmits<{
  "update:modelValue": [value: string | string[]];
  change: [value: string | string[]];
  focus: [event: FocusEvent];
  blur: [event: FocusEvent];
}>();
```

---

## 三、CSS 类名规范

### 3.1 BEM 命名规范

```
格式：chips-{block}__{element}--{modifier}
```

```vue
<template>
  <!-- Block -->
  <div class="chips-card">
    
    <!-- Element -->
    <div class="chips-card__header">
      <h3 class="chips-card__title">标题</h3>
    </div>
    
    <div class="chips-card__content">
      内容
    </div>
    
    <!-- Modifier -->
    <div :class="[
      'chips-card__footer',
      { 'chips-card__footer--sticky': isSticky }
    ]">
      底部
    </div>
    
  </div>
</template>
```

### 3.2 类名规则

| 规则 | 示例 | 说明 |
|------|------|------|
| 所有类名必须以 `chips-` 开头 | `chips-button` | 命名空间隔离 |
| Block（组件） | `chips-button` | 组件基类 |
| Element（元素） | `chips-button__icon` | 双下划线连接 |
| Modifier（修饰符） | `chips-button--primary` | 双连字符连接 |
| 状态类 | `chips-button--disabled` | 表示状态 |
| 动态类 | `:class="{ 'chips-button--active': isActive }"` | Vue 动态绑定 |

### 3.3 禁止的类名

```vue
<!-- ❌ 错误的类名 -->
<template>
  <!-- 缺少 chips- 前缀 -->
  <button class="button">

</button>
  
  <!-- 使用下划线而不是连字符 -->
  <button class="chips_button">按钮</button>
  
  <!-- 混用命名风格 -->
  <button class="chipsButton">按钮</button>
</template>
```

---

## 四、样式接口点规范

### 4.1 布局 vs 样式分离

组件中可以包含**布局相关**的内联样式，但不能包含**视觉样式**：

```vue
<template>
  <!-- ✅ 允许：布局相关的动态计算 -->
  <div :style="{ 
    width: `${width}px`,           <!-- 动态宽度 -->
    height: `${height}px`,         <!-- 动态高度 -->
    transform: `translate(${x}px, ${y}px)`,  <!-- 位置 -->
    gridTemplateColumns: `repeat(${columns}, 1fr)`  <!-- 网格 -->
  }">
    ...
  </div>
  
  <!-- ❌ 禁止：视觉样式 -->
  <div :style="{ 
    backgroundColor: '#1890ff',    <!-- ❌ 颜色 -->
    padding: '8px',                <!-- ❌ 间距 -->
    borderRadius: '4px',           <!-- ❌ 圆角 -->
    boxShadow: '0 2px 4px rgba(0,0,0,0.1)'  <!-- ❌ 阴影 -->
  }">
    ...
  </div>
</template>
```

### 4.2 CSS 变量使用

组件暴露接口点，主题包实现样式：

```vue
<!-- 组件：只定义类名 -->
<template>
  <button class="chips-button chips-button--primary">
    <slot />
  </button>
</template>
```

```css
/* 主题包：实现样式 */
.chips-button {
  /* 布局（固定） */
  display: inline-flex;
  align-items: center;
  gap: var(--chips-spacing-2);
  
  /* 样式（可定制） */
  background: var(--chips-button-bg);
  color: var(--chips-button-text);
  border-radius: var(--chips-button-radius);
  padding: var(--chips-button-padding);
  font-size: var(--chips-button-font-size);
}

.chips-button--primary {
  background: var(--chips-button-primary-bg);
  color: var(--chips-button-primary-text);
}
```

---

## 五、组合式 API 规范

### 5.1 Composables 命名

所有可组合函数必须以 `use` 开头：

```typescript
// ✅ 正确
function useDialog() { }
function useTheme() { }
function useClickOutside() { }

// ❌ 错误
function dialog() { }        // 缺少 use 前缀
function getTheme() { }      // 不是 composable 模式
```

### 5.2 示例：useClickOutside

```typescript
// @chips/components/composables/useClickOutside.ts

import { onMounted, onUnmounted, Ref } from "vue";

export function useClickOutside(
  elementRef: Ref<HTMLElement | null>,
  callback: () => void
) {
  const handleClick = (e: MouseEvent) => {
    if (!elementRef.value) return;
    
    if (!elementRef.value.contains(e.target as Node)) {
      callback();
    }
  };
  
  onMounted(() => {
    document.addEventListener("click", handleClick);
  });
  
  onUnmounted(() => {
    document.removeEventListener("click", handleClick);
  });
}

// 使用示例
const dialogRef = ref<HTMLElement | null>(null);

useClickOutside(dialogRef, () => {
  closeDialog();
});
```

### 5.3 常用 Composables

| Composable | 用途 |
|------------|------|
| `useTheme` | 获取和切换主题 |
| `useI18n` | 多语言翻译 |
| `useClickOutside` | 点击外部关闭 |
| `useKeyboard` | 键盘事件处理 |
| `useFocusTrap` | 焦点陷阱（模态框） |
| `useResizeObserver` | 监听尺寸变化 |
| `useIntersectionObserver` | 监听可见性 |

---

## 六、组件测试规范

### 6.1 Vitest + Vue Test Utils

```typescript
// Button.test.ts
import { describe, it, expect } from "vitest";
import { mount } from "@vue/test-utils";
import Button from "./Button.vue";

describe("Button", () => {
  it("应该渲染正确的类名", () => {
    const wrapper = mount(Button, {
      props: {
        type: "primary",
        size: "large"
      }
    });
    
    expect(wrapper.classes()).toContain("chips-button");
    expect(wrapper.classes()).toContain("chips-button--primary");
    expect(wrapper.classes()).toContain("chips-button--large");
  });
  
  it("禁用时不应触发点击事件", async () => {
    const onClick = vi.fn();
    const wrapper = mount(Button, {
      props: {
        disabled: true
      },
      attrs: {
        onClick
      }
    });
    
    await wrapper.trigger("click");
    expect(onClick).not.toHaveBeenCalled();
  });
  
  it("加载中时应显示 spinner", () => {
    const wrapper = mount(Button, {
      props: {
        loading: true
      }
    });
    
    expect(wrapper.find(".chips-button__spinner").exists()).toBe(true);
  });
});
```

### 6.2 测试覆盖率要求

| 模块 | 覆盖率 |
|------|--------|
| 核心组件 | ≥ 90% |
| 工具函数 | ≥ 95% |
| Composables | ≥ 90% |
| 类型定义 | 100% |

---

## 七、Storybook 文档规范

### 7.1 Story 文件结构

```typescript
// Button.stories.ts
import type { Meta, StoryObj } from "@storybook/vue3";
import Button from "./Button.vue";

const meta: Meta<typeof Button> = {
  title: "Components/Button",
  component: Button,
  tags: ["autodocs"],
  argTypes: {
    type: {
      control: "select",
      options: ["default", "primary", "dashed", "danger"],
      description: "按钮类型"
    },
    size: {
      control: "select",
      options: ["small", "medium", "large"],
      description: "按钮尺寸"
    },
    disabled: {
      control: "boolean",
      description: "是否禁用"
    },
    loading: {
      control: "boolean",
      description: "是否加载中"
    }
  }
};

export default meta;
type Story = StoryObj<typeof Button>;

// 默认示例
export const Default: Story = {
  args: {
    default: "默认按钮"
  }
};

// 主要按钮
export const Primary: Story = {
  args: {
    type: "primary",
    default: "主要按钮"
  }
};

// 所有尺寸
export const AllSizes: Story = {
  render: () => ({
    components: { Button },
    template: `
      <div style="display: flex; gap: 8px; align-items: center;">
        <Button size="small">小按钮</Button>
        <Button size="medium">中按钮</Button>
        <Button size="large">大按钮</Button>
      </div>
    `
  })
};

// 所有类型
export const AllTypes: Story = {
  render: () => ({
    components: { Button },
    template: `
      <div style="display: flex; gap: 8px; flex-direction: column;">
        <Button type="default">默认按钮</Button>
        <Button type="primary">主要按钮</Button>
        <Button type="dashed">虚线按钮</Button>
        <Button type="danger">危险按钮</Button>
      </div>
    `
  })
};

// 所有状态
export const AllStates: Story = {
  render: () => ({
    components: { Button },
    template: `
      <div style="display: flex; gap: 8px;">
        <Button>正常</Button>
        <Button disabled>禁用</Button>
        <Button loading>加载中</Button>
      </div>
    `
  })
};
```

### 7.2 Story 要求

- [ ] 每个组件必须有 Story 文件
- [ ] 必须展示所有 Props 变体
- [ ] 必须包含交互示例
- [ ] 必须添加 JSDoc 注释
- [ ] 建议添加使用说明

---

## 八、无障碍性规范

### 8.1 ARIA 属性

```vue
<template>
  <!-- ✅ 正确：完整的 ARIA 支持 -->
  <button
    class="chips-button"
    role="button"
    :aria-busy="loading"
    :aria-disabled="disabled"
    :aria-label="ariaLabel"
    :disabled="disabled || loading"
  >
    <span v-if="loading" class="chips-button__spinner" aria-hidden="true" />
    <slot />
  </button>
  
  <!-- Dialog 示例 -->
  <div
    v-if="visible"
    role="dialog"
    aria-modal="true"
    :aria-labelledby="titleId"
    :aria-describedby="contentId"
  >
    <h2 :id="titleId">{{ title }}</h2>
    <div :id="contentId">
      <slot />
    </div>
  </div>
</template>
```

### 8.2 键盘导航

```vue
<script setup lang="ts">
// Select 组件键盘导航示例
const handleKeyDown = (e: KeyboardEvent) => {
  switch (e.key) {
    case "Enter":
    case " ":
      e.preventDefault();
      toggleOpen();
      break;
      
    case "Escape":
      e.preventDefault();
      close();
      break;
      
    case "ArrowDown":
      e.preventDefault();
      focusNext();
      break;
      
    case "ArrowUp":
      e.preventDefault();
      focusPrevious();
      break;
      
    case "Home":
      e.preventDefault();
      focusFirst();
      break;
      
    case "End":
      e.preventDefault();
      focusLast();
      break;
  }
};
</script>

<template>
  <div
    role="combobox"
    :aria-expanded="isOpen"
    aria-haspopup="listbox"
    :aria-controls="listboxId"
    tabindex="0"
    @keydown="handleKeyDown"
  >
    <!-- 选择器内容 -->
  </div>
</template>
```

### 8.3 焦点管理

```typescript
// useFocusTrap composable
import { ref, onMounted, onUnmounted, watch } from "vue";

export function useFocusTrap(containerRef: Ref<HTMLElement | null>) {
  const focusableElements = ref<HTMLElement[]>([]);
  
  const updateFocusableElements = () => {
    if (!containerRef.value) return;
    
    const elements = containerRef.value.querySelectorAll(
      'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
    );
    
    focusableElements.value = Array.from(elements) as HTMLElement[];
  };
  
  const trapFocus = (e: KeyboardEvent) => {
    if (e.key !== "Tab") return;
    
    const { value: elements } = focusableElements;
    if (elements.length === 0) return;
    
    const firstElement = elements[0];
    const lastElement = elements[elements.length - 1];
    
    if (e.shiftKey) {
      // Shift + Tab
      if (document.activeElement === firstElement) {
        e.preventDefault();
        lastElement.focus();
      }
    } else {
      // Tab
      if (document.activeElement === lastElement) {
        e.preventDefault();
        firstElement.focus();
      }
    }
  };
  
  watch(containerRef, () => {
    updateFocusableElements();
  });
  
  onMounted(() => {
    document.addEventListener("keydown", trapFocus);
    updateFocusableElements();
  });
  
  onUnmounted(() => {
    document.removeEventListener("keydown", trapFocus);
  });
}
```

---

## 九、性能优化规范

### 9.1 组件性能优化

```vue
<script setup lang="ts">
import { computed } from "vue";

// ✅ 使用 computed 缓存计算结果
const buttonClass = computed(() => [
  "chips-button",
  `chips-button--${props.type}`,
  `chips-button--${props.size}`,
  { "chips-button--disabled": props.disabled }
]);

// ✅ 避免在模板中进行复杂计算
const formattedDate = computed(() => {
  return formatDate(props.date);
});
</script>

<template>
  <!-- ✅ 使用 computed 结果 -->
  <button :class="buttonClass">
    {{ formattedDate }}
  </button>
  
  <!-- ❌ 避免在模板中直接调用函数 -->
  <button :class="getButtonClass()">
    {{ formatDate(date) }}
  </button>
</template>
```

### 9.2 列表渲染优化

```vue
<template>
  <!-- ✅ 使用 key -->
  <div v-for="item in items" :key="item.id">
    {{ item.name }}
  </div>
  
  <!-- ✅ 虚拟滚动长列表 -->
  <VirtualList
    :items="items"
    :item-height="50"
  >
    <template #default="{ item }">
      <div>{{ item.name }}</div>
    </template>
  </VirtualList>
  
  <!-- ❌ 使用 index 作为 key -->
  <div v-for="(item, index) in items" :key="index">
    {{ item.name }}
  </div>
</template>
```

### 9.3 避免不必要的响应式

```typescript
// ✅ 使用 shallowRef 和 shallowReactive
import { shallowRef, shallowReactive } from "vue";

// 大型不可变对象使用 shallowRef
const largeData = shallowRef<LargeData>({});

// 只需要第一层响应式
const state = shallowReactive({
  count: 0,
  items: []  // items 内部不需要深度响应式
});

// ✅ 使用 markRaw 标记不需要响应式的对象
import { markRaw } from "vue";

const editor = markRaw(new EditorInstance());
```

---

## 十、组件库项目配置

### 10.1 package.json

```json
{
  "name": "@chips/components",
  "version": "1.0.0",
  "description": "薯片生态 Vue 3 无样式组件库",
  "type": "module",
  "main": "./dist/index.js",
  "module": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "import": "./dist/index.js",
      "types": "./dist/index.d.ts"
    },
    "./button": {
      "import": "./dist/button/index.js",
      "types": "./dist/button/index.d.ts"
    }
  },
  "files": [
    "dist"
  ],
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc && vite build",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "coverage": "vitest --coverage",
    "storybook": "storybook dev -p 6006",
    "build-storybook": "storybook build",
    "lint": "eslint --ext .ts,.vue src",
    "type-check": "vue-tsc --noEmit"
  },
  "peerDependencies": {
    "vue": "^3.4.0"
  },
  "dependencies": {
    "@floating-ui/vue": "^1.0.0",
    "@vueuse/core": "^10.7.0",
    "@iconify/vue": "^4.1.0"
  },
  "devDependencies": {
    "@storybook/vue3": "^8.0.0",
    "@vitejs/plugin-vue": "^5.0.0",
    "@vue/test-utils": "^2.4.0",
    "typescript": "^5.3.0",
    "vite": "^5.1.0",
    "vite-plugin-dts": "^3.7.0",
    "vitest": "^1.2.0",
    "vue-tsc": "^1.8.0"
  }
}
```

### 10.2 tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "preserve",
    
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src/**/*.ts", "src/**/*.vue"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

### 10.3 vite.config.ts

```typescript
import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";
import dts from "vite-plugin-dts";
import { resolve } from "path";

export default defineConfig({
  plugins: [
    vue(),
    dts({
      include: ["src/**/*.ts", "src/**/*.vue"],
      exclude: ["src/**/*.test.ts", "src/**/*.stories.ts"]
    })
  ],
  
  build: {
    lib: {
      entry: resolve(__dirname, "src/index.ts"),
      name: "ChipsComponents",
      fileName: "index"
    },
    rollupOptions: {
      external: ["vue"],
      output: {
        globals: {
          vue: "Vue"
        }
      }
    }
  },
  
  resolve: {
    alias: {
      "@": resolve(__dirname, "src")
    }
  }
});
```

---

## 十一、组件库目录结构

```
@chips/components/
├── src/
│   ├── components/           # 组件
│   │   ├── button/
│   │   │   ├── Button.vue
│   │   │   ├── Button.test.ts
│   │   │   ├── Button.stories.ts
│   │   │   └── index.ts
│   │   ├── input/
│   │   ├── dialog/
│   │   └── ...
│   │
│   ├── composables/          # 组合式函数
│   │   ├── useTheme.ts
│   │   ├── useClickOutside.ts
│   │   └── ...
│   │
│   ├── utils/                # 工具函数
│   │   ├── classNames.ts
│   │   ├── dom.ts
│   │   └── ...
│   │
│   ├── types/                # 类型定义
│   │   ├── components.ts
│   │   └── theme.ts
│   │
│   └── index.ts              # 入口文件
│
├── dist/                     # 构建输出
├── .storybook/               # Storybook 配置
├── package.json
├── vite.config.ts
├── tsconfig.json
└── README.md
```

---

## 十二、代码审查清单

### 组件提交前检查

- [ ] 组件不包含 `<style>` 标签
- [ ] 不使用内联样式（除非动态布局）
- [ ] 所有类名以 `chips-` 开头
- [ ] 遵循 BEM 命名规范
- [ ] Props 有完整的 TypeScript 类型
- [ ] Emits 有完整的类型定义
- [ ] 包含完整的 ARIA 属性
- [ ] 支持键盘导航
- [ ] 编写了单元测试
- [ ] 编写了 Storybook 文档
- [ ] 测试覆盖率达标
- [ ] 所有文本使用多语言系统
- [ ] 通过 ESLint 检查
- [ ] 通过 TypeScript 检查

---

**文档维护者**: Chips生态团队  
**技术栈**: Vue 3 + TypeScript  
**最后审核**: 2026-01-30  
**状态**: ✅ 生效
