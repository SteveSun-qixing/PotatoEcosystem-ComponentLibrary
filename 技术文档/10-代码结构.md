# 代码结构

## 项目目录结构

```
chips-ui/
├── .github/                 # GitHub配置
│   └── workflows/           # CI/CD工作流
│       ├── ci.yml
│       ├── release.yml
│       └── deploy-docs.yml
├── .storybook/              # Storybook配置
│   ├── main.ts
│   ├── preview.ts
│   └── theme.ts
├── docs/                    # 文档
│   ├── guide/               # 使用指南
│   ├── components/          # 组件文档
│   ├── theme/               # 主题文档
│   └── api/                 # API文档
├── examples/                # 示例代码
│   ├── react/
│   ├── vue/
│   └── svelte/
├── packages/                # Monorepo包
│   ├── core/                # 核心包(框架无关)
│   │   ├── src/
│   │   │   ├── components/  # 组件逻辑
│   │   │   ├── hooks/       # Hooks
│   │   │   ├── utils/       # 工具函数
│   │   │   ├── types/       # 类型定义
│   │   │   └── index.ts
│   │   ├── tests/
│   │   └── package.json
│   ├── react/               # React适配包
│   │   ├── src/
│   │   │   ├── components/
│   │   │   ├── hooks/
│   │   │   └── index.ts
│   │   ├── tests/
│   │   └── package.json
│   ├── vue/                 # Vue适配包
│   │   ├── src/
│   │   │   ├── components/
│   │   │   └── index.ts
│   │   ├── tests/
│   │   └── package.json
│   └── theme-default/       # 默认主题包
│       ├── src/
│       │   ├── tokens.css
│       │   ├── components/
│       │   └── index.css
│       └── package.json
├── scripts/                 # 构建脚本
│   ├── build.ts
│   ├── generate-types.ts
│   └── release.ts
├── tests/                   # 测试配置和共享测试工具
│   ├── setup.ts
│   ├── utils.ts
│   └── mocks/
├── .eslintrc.js             # ESLint配置
├── .prettierrc              # Prettier配置
├── jest.config.js           # Jest配置
├── tsconfig.json            # TypeScript配置
├── vite.config.ts           # Vite配置
├── package.json             # 根package.json
├── pnpm-workspace.yaml      # pnpm workspace配置
├── CHANGELOG.md             # 更新日志
├── CONTRIBUTING.md          # 贡献指南
├── LICENSE                  # 许可证
└── README.md                # 项目说明
```

## 核心包结构

```
packages/core/
├── src/
│   ├── components/          # 组件目录
│   │   ├── Button/
│   │   │   ├── __tests__/
│   │   │   │   └── Button.test.ts
│   │   │   ├── Button.ts
│   │   │   ├── types.ts
│   │   │   ├── utils.ts
│   │   │   ├── README.md
│   │   │   └── index.ts
│   │   ├── Input/
│   │   ├── Select/
│   │   └── index.ts         # 组件导出
│   ├── hooks/               # 通用Hooks
│   │   ├── useTheme.ts
│   │   ├── useKernel.ts
│   │   ├── useControllableState.ts
│   │   └── index.ts
│   ├── utils/               # 工具函数
│   │   ├── classNames.ts
│   │   ├── mergeRefs.ts
│   │   ├── composeEventHandlers.ts
│   │   └── index.ts
│   ├── constants/           # 常量定义
│   │   ├── componentNames.ts
│   │   ├── propTypes.ts
│   │   └── index.ts
│   ├── types/               # 类型定义
│   │   ├── component.ts
│   │   ├── theme.ts
│   │   ├── event.ts
│   │   └── index.ts
│   ├── theme/               # 主题系统
│   │   ├── ThemeContext.ts
│   │   ├── ThemeProvider.ts
│   │   ├── ThemeLoader.ts
│   │   └── index.ts
│   ├── kernel/              # 内核通信
│   │   ├── SDKIntegration.ts
│   │   ├── RequestManager.ts
│   │   ├── EventManager.ts
│   │   └── index.ts
│   └── index.ts             # 入口文件
├── tests/
│   ├── Button.test.ts
│   ├── Input.test.ts
│   └── ...
├── package.json
├── tsconfig.json
└── README.md
```

## 组件目录结构

每个组件都遵循统一的目录结构:

```
Button/
├── __tests__/               # 测试文件
│   ├── Button.test.ts       # 单元测试
│   ├── Button.a11y.test.ts  # 可访问性测试
│   └── __snapshots__/       # 快照
│       └── Button.test.ts.snap
├── Button.ts                # 组件实现
├── Button.stories.ts        # Storybook故事
├── types.ts                 # 类型定义
├── utils.ts                 # 组件专用工具函数
├── constants.ts             # 组件专用常量
├── README.md                # 组件文档
└── index.ts                 # 组件导出
```

## React适配包结构

```
packages/react/
├── src/
│   ├── components/          # React组件
│   │   ├── Button/
│   │   │   ├── Button.tsx
│   │   │   ├── index.ts
│   │   │   └── Button.stories.tsx
│   │   ├── Input/
│   │   └── index.ts
│   ├── hooks/               # React专用Hooks
│   │   ├── useTheme.ts
│   │   ├── useKernel.ts
│   │   └── index.ts
│   ├── providers/           # Context Providers
│   │   ├── ThemeProvider.tsx
│   │   ├── ChipsProvider.tsx
│   │   └── index.ts
│   └── index.ts
├── tests/
├── package.json
└── README.md
```

## 主题包结构

```
packages/theme-default/
├── src/
│   ├── tokens/              # 设计tokens
│   │   ├── colors.css
│   │   ├── typography.css
│   │   ├── spacing.css
│   │   ├── shadows.css
│   │   └── index.css
│   ├── base/                # 基础样式
│   │   ├── reset.css
│   │   ├── global.css
│   │   └── index.css
│   ├── components/          # 组件样式
│   │   ├── button.css
│   │   ├── input.css
│   │   ├── select.css
│   │   └── ...
│   ├── cards/               # 卡片样式
│   │   ├── markdown.css
│   │   ├── image.css
│   │   └── ...
│   ├── utilities/           # 工具类
│   │   ├── layout.css
│   │   ├── spacing.css
│   │   └── typography.css
│   └── index.css            # 入口文件
├── dist/                    # 构建输出
│   ├── index.css
│   └── index.min.css
├── preview.png              # 预览图
├── screenshots/             # 组件截图
├── package.json
└── README.md
```

## 文件命名规范

### 组件文件

- 组件主文件: `ComponentName.ts` 或 `ComponentName.tsx`
- 类型定义: `types.ts`
- 测试文件: `ComponentName.test.ts`
- 故事文件: `ComponentName.stories.ts`
- 样式文件: `ComponentName.css` 或 `componentName.css`

### 工具文件

- 工具函数: `utilityName.ts`
- Hooks: `useHookName.ts`
- 常量: `constants.ts` 或 `CONSTANT_NAME.ts`
- 类型: `types.ts` 或 `TypeName.ts`

### 目录命名

- 组件目录: PascalCase - `Button/`, `InputField/`
- 工具目录: camelCase - `utils/`, `hooks/`
- 常量目录: camelCase - `constants/`

## 导入导出规范

### 使用命名导出

```typescript
// ✅ 好: 使用命名导出
export function Button(props: ButtonProps) {
  // ...
}

export { Button };

// ❌ 避免: 使用默认导出
export default Button;
```

### 统一的导出入口

每个目录都有`index.ts`作为导出入口:

```typescript
// components/Button/index.ts
export { Button } from './Button';
export type { ButtonProps } from './types';

// components/index.ts
export { Button } from './Button';
export { Input } from './Input';
export { Select } from './Select';

// 根index.ts
export * from './components';
export * from './hooks';
export * from './utils';
export * from './types';
```

### 导入顺序

```typescript
// 1. 外部依赖
import React, { useState, useEffect } from 'react';
import classNames from 'classnames';

// 2. 内部依赖(绝对路径)
import { useTheme } from '@/hooks';
import { mergeRefs } from '@/utils';

// 3. 相对路径导入
import { ButtonProps } from './types';
import { getButtonClassName } from './utils';

// 4. 样式导入(如果有)
import './Button.css';

// 5. 类型导入
import type { Theme } from '@/types';
```

## 代码组织原则

### 单一职责

每个文件只负责一件事:

```typescript
// Button.ts - 只包含组件逻辑
export function Button(props: ButtonProps) {
  // 组件实现
}

// types.ts - 只包含类型定义
export interface ButtonProps {
  // 类型定义
}

// utils.ts - 只包含工具函数
export function getButtonClassName(type: string) {
  // 工具函数实现
}
```

### DRY原则

避免重复代码,提取公共逻辑:

```typescript
// utils/classNames.ts - 通用工具
export function classNames(...args: ClassValue[]): string {
  // 实现
}

// 在多个组件中使用
import { classNames } from '@/utils';
```

### 分层架构

- **展示层**: 组件UI
- **逻辑层**: Hooks和工具函数
- **数据层**: 状态管理和API调用
- **类型层**: TypeScript类型定义

## Monorepo管理

### 使用pnpm workspace

```yaml
# pnpm-workspace.yaml
packages:
  - 'packages/*'
```

### 包依赖关系

```json
// packages/react/package.json
{
  "name": "@chips-ui/react",
  "dependencies": {
    "@chips-ui/core": "workspace:*",
    "react": "^18.0.0"
  }
}
```

### 共享配置

根目录的配置文件被所有包共享:

```
chips-ui/
├── tsconfig.json        # 共享TypeScript配置
├── .eslintrc.js        # 共享ESLint配置
└── packages/
    ├── core/
    │   └── tsconfig.json # 继承根配置
    └── react/
        └── tsconfig.json # 继承根配置
```

```json
// packages/core/tsconfig.json
{
  "extends": "../../tsconfig.json",
  "compilerOptions": {
    "outDir": "./dist",
    "rootDir": "./src"
  },
  "include": ["src"]
}
```

## 构建输出

### 多格式输出

```
dist/
├── es/                  # ES模块
│   ├── index.js
│   ├── Button.js
│   └── ...
├── lib/                 # CommonJS
│   ├── index.js
│   ├── Button.js
│   └── ...
├── umd/                 # UMD
│   ├── chips-ui.js
│   └── chips-ui.min.js
└── types/               # TypeScript类型声明
    ├── index.d.ts
    ├── Button.d.ts
    └── ...
```

### package.json配置

```json
{
  "name": "@chips-ui/react",
  "main": "./dist/lib/index.js",
  "module": "./dist/es/index.js",
  "types": "./dist/types/index.d.ts",
  "exports": {
    ".": {
      "import": "./dist/es/index.js",
      "require": "./dist/lib/index.js",
      "types": "./dist/types/index.d.ts"
    },
    "./Button": {
      "import": "./dist/es/Button.js",
      "require": "./dist/lib/Button.js",
      "types": "./dist/types/Button.d.ts"
    }
  },
  "files": [
    "dist",
    "README.md"
  ]
}
```

## Git提交规范

### Commit message格式

```
type(scope): subject

body

footer
```

### Type类型

- `feat`: 新功能
- `fix`: Bug修复
- `docs`: 文档更新
- `style`: 代码格式(不影响代码运行)
- `refactor`: 重构
- `perf`: 性能优化
- `test`: 测试
- `build`: 构建系统
- `ci`: CI配置
- `chore`: 其他修改

### 示例

```
feat(Button): 添加loading状态

- 添加loading prop
- 添加loading图标
- 禁用点击事件

Closes #123
```

## 版本发布

### 版本号规范

遵循语义化版本 (Semantic Versioning):

- 主版本号: 不兼容的API修改
- 次版本号: 向后兼容的功能性新增
- 修订号: 向后兼容的bug修复

### Changelog

每次发布自动生成changelog:

```markdown
# @chips-ui/react

## 2.1.0

### Features

- **Button**: 添加loading状态 (#123)
- **Input**: 支持clearable (#124)

### Bug Fixes

- **Select**: 修复下拉菜单位置 (#125)

### Breaking Changes

- **Modal**: 移除deprecated的API (#126)
```

## 总结

代码结构采用Monorepo架构,清晰地组织了核心包、框架适配包和主题包。每个包都有统一的目录结构和命名规范。通过合理的文件组织、清晰的导入导出、严格的代码规范,确保了项目的可维护性和可扩展性。构建输出支持多种格式,满足不同使用场景的需求。
