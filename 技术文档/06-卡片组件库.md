# 卡片辅助组件库设计

## 概述

卡片辅助组件为基础卡片插件开发提供通用的 UI 辅助功能。这些组件不是具体的卡片实现，而是供插件开发者在实现基础卡片时使用的工具组件。

> **重要说明**：具体的基础卡片组件（如 MarkdownCard、VideoCard、ImageCard 等）**不属于组件库**，它们应该在各自的**基础卡片插件**中实现。详见 [插件开发规范](../../生态共用/07-插件开发规范.md) 和 [基础卡片插件的结构](../../生态设计原稿（一切标准）/03-基础卡片插件的结构.md)。

## 架构关系

```
┌─────────────────────────────────────────────────────────────┐
│                    基础卡片插件                              │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │ 视频卡片插件 │ │Markdown插件 │ │ 图片卡片插件 │           │
│  │             │ │             │ │             │           │
│  │ • 渲染组件  │ │ • 渲染组件  │ │ • 渲染组件  │           │
│  │ • 编辑组件  │ │ • 编辑组件  │ │ • 编辑组件  │           │
│  └──────┬──────┘ └──────┬──────┘ └──────┬──────┘           │
│         │               │               │                   │
│         └───────────────┼───────────────┘                   │
│                         │ 可选使用                          │
└─────────────────────────┼───────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│                   薯片组件库 - 卡片辅助组件                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  CardWrapper │ CardHeader │ CardLoading │ CardError │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

## CardWrapper 卡片包装器

### 组件设计

卡片包装器为基础卡片提供通用的外层容器，处理主题应用、编辑状态等通用逻辑。

```vue
<script setup lang="ts">
interface CardWrapperProps {
  /** 卡片ID */
  cardId: string;
  /** 卡片类型标识 */
  cardType: string;
  /** 主题包标识 */
  theme?: string;
  /** 是否可编辑模式 */
  editable?: boolean;
}

const props = withDefaults(defineProps<CardWrapperProps>(), {
  editable: false
});

const emit = defineEmits<{
  edit: [];
}>();

// 注入主题
const { injectTheme } = useTheme();
const themeClass = computed(() => {
  return props.theme ? `chips-theme-${props.theme}` : '';
});
</script>

<template>
  <div
    :class="[
      'chips-card-wrapper',
      `chips-card-wrapper--${cardType}`,
      { 'chips-card-wrapper--editable': editable },
      themeClass
    ]"
    :data-card-id="cardId"
    :data-card-type="cardType"
  >
    <div class="chips-card-wrapper__header">
      <slot name="header" />
    </div>
    <div class="chips-card-wrapper__content">
      <slot />
    </div>
    <div v-if="editable" class="chips-card-wrapper__actions">
      <slot name="actions">
        <button
          class="chips-card-wrapper__edit-btn"
          @click="emit('edit')"
        >
          <slot name="edit-icon" />
        </button>
      </slot>
    </div>
  </div>
</template>
```

### 样式接口点

```css
.chips-card-wrapper {
  /* 卡片包装容器 */
}

.chips-card-wrapper--editable {
  /* 可编辑状态 */
}

.chips-card-wrapper__header {
  /* 头部区域 */
}

.chips-card-wrapper__content {
  /* 内容区域 */
}

.chips-card-wrapper__actions {
  /* 操作区域 */
}

.chips-card-wrapper__edit-btn {
  /* 编辑按钮 */
}
```

## CardHeader 卡片头部

### 组件设计

```vue
<script setup lang="ts">
import { useI18n } from '@chips/i18n';

interface CardHeaderProps {
  /** 卡片标题（词汇key） */
  title?: string;
  /** 是否显示关闭按钮 */
  closable?: boolean;
}

const props = withDefaults(defineProps<CardHeaderProps>(), {
  closable: false
});

const emit = defineEmits<{
  close: [];
}>();

const { t } = useI18n();
</script>

<template>
  <div class="chips-card-header">
    <div class="chips-card-header__title">
      <slot name="title">
        {{ title ? t(title) : '' }}
      </slot>
    </div>
    <div class="chips-card-header__actions">
      <slot name="actions" />
      <button
        v-if="closable"
        class="chips-card-header__close"
        @click="emit('close')"
      >
        <slot name="close-icon" />
      </button>
    </div>
  </div>
</template>
```

### 样式接口点

```css
.chips-card-header {
  /* 头部容器 */
}

.chips-card-header__title {
  /* 标题 */
}

.chips-card-header__actions {
  /* 操作区域 */
}

.chips-card-header__close {
  /* 关闭按钮 */
}
```

## CardLoading 卡片加载状态

### 组件设计

```vue
<script setup lang="ts">
import { useI18n } from '@chips/i18n';

interface CardLoadingProps {
  /** 加载提示文本（词汇key） */
  tip?: string;
}

const props = defineProps<CardLoadingProps>();

const { t } = useI18n();
</script>

<template>
  <div class="chips-card-loading">
    <div class="chips-card-loading__spinner">
      <slot name="spinner">
        <!-- 默认加载动画 -->
        <span class="chips-card-loading__dot" />
        <span class="chips-card-loading__dot" />
        <span class="chips-card-loading__dot" />
      </slot>
    </div>
    <div v-if="tip" class="chips-card-loading__tip">
      {{ t(tip) }}
    </div>
  </div>
</template>
```

### 样式接口点

```css
.chips-card-loading {
  /* 加载容器 */
}

.chips-card-loading__spinner {
  /* 加载动画容器 */
}

.chips-card-loading__dot {
  /* 加载点 */
}

.chips-card-loading__tip {
  /* 提示文本 */
}
```

## CardError 卡片错误状态

### 组件设计

```vue
<script setup lang="ts">
import { useI18n } from '@chips/i18n';

interface CardErrorProps {
  /** 错误信息 */
  error: string | Error;
  /** 是否可重试 */
  retryable?: boolean;
}

const props = withDefaults(defineProps<CardErrorProps>(), {
  retryable: false
});

const emit = defineEmits<{
  retry: [];
}>();

const { t } = useI18n();

const errorMessage = computed(() => {
  if (typeof props.error === 'string') {
    return props.error;
  }
  return props.error.message;
});
</script>

<template>
  <div class="chips-card-error">
    <div class="chips-card-error__icon">
      <slot name="icon" />
    </div>
    <div class="chips-card-error__message">
      {{ errorMessage }}
    </div>
    <button
      v-if="retryable"
      class="chips-card-error__retry"
      @click="emit('retry')"
    >
      {{ t('common.retry') }}
    </button>
  </div>
</template>
```

### 样式接口点

```css
.chips-card-error {
  /* 错误容器 */
}

.chips-card-error__icon {
  /* 错误图标 */
}

.chips-card-error__message {
  /* 错误信息 */
}

.chips-card-error__retry {
  /* 重试按钮 */
}
```

## CardPlaceholder 卡片占位符

### 组件设计

```vue
<script setup lang="ts">
import { useI18n } from '@chips/i18n';

interface CardPlaceholderProps {
  /** 占位图标 */
  icon?: string;
  /** 占位文本（词汇key） */
  text?: string;
  /** 操作按钮文本（词汇key） */
  actionText?: string;
}

const props = defineProps<CardPlaceholderProps>();

const emit = defineEmits<{
  action: [];
}>();

const { t } = useI18n();
</script>

<template>
  <div class="chips-card-placeholder">
    <div v-if="icon" class="chips-card-placeholder__icon">
      <slot name="icon" />
    </div>
    <div v-if="text" class="chips-card-placeholder__text">
      {{ t(text) }}
    </div>
    <button
      v-if="actionText"
      class="chips-card-placeholder__action"
      @click="emit('action')"
    >
      {{ t(actionText) }}
    </button>
  </div>
</template>
```

### 样式接口点

```css
.chips-card-placeholder {
  /* 占位容器 */
}

.chips-card-placeholder__icon {
  /* 图标 */
}

.chips-card-placeholder__text {
  /* 文本 */
}

.chips-card-placeholder__action {
  /* 操作按钮 */
}
```

## 与基础卡片插件的关系

### 架构说明

组件库的卡片辅助组件与基础卡片插件是**解耦**的关系：

1. **卡片辅助组件**：由组件库提供，是通用的 UI 工具
2. **基础卡片插件**：独立的插件包，包含特定卡片类型的完整实现
3. **使用关系**：插件**可选**使用辅助组件，不是强制依赖

### 插件开发示例

基础卡片插件可以选择使用这些辅助组件：

```typescript
// 视频卡片插件的渲染组件
import { CardWrapper, CardLoading, CardError } from '@chips/components';

class VideoCardRenderer implements BaseCardRenderer {
  private container: HTMLElement;
  
  async render(config: VideoCardConfig, container: HTMLElement): Promise<void> {
    this.container = container;
    
    // 方式1：使用 CardWrapper（可选）
    const wrapper = this.createWrapper(config);
    
    // 显示加载状态
    this.showLoading();
    
    try {
      // 加载视频播放器（调用基础层 VideoPlayer）
      const player = await this.loadVideoPlayer(config);
      this.showContent(player);
    } catch (error) {
      this.showError(error);
    }
  }
  
  private createWrapper(config: VideoCardConfig): void {
    // 可以使用组件库的 CardWrapper，也可以自己实现
    // 组件库提供的是通用实现，插件可以选择
  }
  
  private async loadVideoPlayer(config: VideoCardConfig): Promise<any> {
    // 调用基础层 VideoPlayer 模块
    return await Core.request({
      target: 'VideoPlayer',
      action: 'render',
      params: {
        container: this.container,
        src: config.video_file,
        poster: config.cover_image
      }
    });
  }
}
```

### 不使用辅助组件的情况

插件开发者也可以完全自己实现所有 UI：

```typescript
// 完全自定义的视频卡片渲染器
class CustomVideoCardRenderer implements BaseCardRenderer {
  async render(config: VideoCardConfig, container: HTMLElement): Promise<void> {
    // 自己实现所有 UI，不使用组件库的辅助组件
    const wrapper = document.createElement('div');
    wrapper.className = 'my-custom-video-wrapper';
    
    // ... 自定义实现
    
    container.appendChild(wrapper);
  }
}
```

## 基础卡片插件的正确位置

基础卡片组件应该在各自的插件包中实现，而不是在组件库中：

| 基础卡片类型 | 插件包名称 | 包含内容 |
|-------------|-----------|---------|
| 富文本卡片 | @chips/plugin-richtext | 渲染组件、编辑组件 |
| Markdown卡片 | @chips/plugin-markdown | 渲染组件、编辑组件 |
| 图片卡片 | @chips/plugin-image | 渲染组件、编辑组件 |
| 视频卡片 | @chips/plugin-video | 渲染组件、编辑组件 |
| 音乐卡片 | @chips/plugin-audio | 渲染组件、编辑组件 |
| 代码块卡片 | @chips/plugin-codeblock | 渲染组件、编辑组件 |
| 列表卡片 | @chips/plugin-list | 渲染组件、编辑组件 |
| 网页卡片 | @chips/plugin-webpage | 渲染组件、编辑组件 |
| ... | ... | ... |

详见 [插件开发规范](../../生态共用/07-插件开发规范.md) 中的"基础卡片插件开发"章节。

## 总结

卡片辅助组件库提供了开发基础卡片插件时可复用的通用 UI 组件。这些组件是可选的工具，插件开发者可以根据需要选择使用。

**核心原则**：

1. 组件库**不包含**具体的基础卡片实现
2. 基础卡片应该在各自的**插件**中实现
3. 辅助组件是**可选**的开发工具
4. 插件与组件库是**解耦**的关系

---

**维护团队**: 薯片生态核心团队  
**最后更新**: 2026-01-31
